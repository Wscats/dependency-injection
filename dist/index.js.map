{"version":3,"sources":["webpack://UserAgent/webpack/universalModuleDefinition","webpack://UserAgent/webpack/bootstrap","webpack://UserAgent/./node_modules/@babel/runtime/helpers/arrayLikeToArray.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/arrayWithHoles.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/construct.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/createClass.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/iterableToArray.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/nonIterableRest.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/setPrototypeOf.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/slicedToArray.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/typeof.js","webpack://UserAgent/./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","webpack://UserAgent/./src/descriptors.ts","webpack://UserAgent/./src/graph.ts","webpack://UserAgent/./src/index.ts","webpack://UserAgent/./src/instantiation.ts","webpack://UserAgent/./src/instantiationService.ts","webpack://UserAgent/./src/serviceCollection.ts"],"names":["SyncDescriptor","ctor","staticArguments","supportsDelayedInstantiation","newNode","data","incoming","Object","create","outcoming","Graph","keyFn","nodes","ret","nodeKey","prototype","hasOwnProperty","call","nodeElement","getOwnPropertyNames","length","push","key","node","from","to","fromNode","lookupOrInsertNode","toNode","fromKey","toKey","delKey","keys","__decorate","decorators","target","desc","c","arguments","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","A","B","serviceA","createDecorator","serviceB","C","a","b","leftText","rightText","echo","aInstance","bInstance","svrsCollection","ServiceCollection","set","instantiationService","InstantiationService","cInstance","createInstance","console","log","echoText","invokeFunction","accessor","bInstance2","get","_util","serviceIds","Map","DI_TARGET","DI_DEPENDENCIES","getServiceDependencies","storeServiceDependency","id","index","optional","serviceId","has","serviceIdentifier","Error","toString","IdleValue","executor","didRun","value","error","serices","services","ctorOrDescriptor","rest","result","createCtorInstance","fn","done","getOrCreateServiceInstance","args","serviceDependencies","sort","serviceArgs","dependency","serviceInstance","thing","getServiceInstanceOrDescriptor","createAndCacheServiceInstance","instanceOrDesc","graph","stack","item","pop","dItem","insertEdge","roots","root","service","createServiceInstance","removeNode","idleObj","Proxy","obj","getValue","prop","bindProp","bind","entries","instanceOrDescriptor","callback","forEach"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA;AACA;;AAEA,wCAAwC,SAAS;AACjD;AACA;;AAEA;AACA;;AAEA,mC;;;;;;;;;;;ACVA;AACA;AACA;;AAEA,iC;;;;;;;;;;;ACJA,uBAAuB,mBAAO,CAAC,qFAAoB;;AAEnD;AACA;AACA;;AAEA,oC;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;;AAEA,iC;;;;;;;;;;;ACNA,qBAAqB,mBAAO,CAAC,iFAAkB;;AAE/C,+BAA+B,mBAAO,CAAC,qGAA4B;;AAEnE;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,4B;;;;;;;;;;;ACrBA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,8B;;;;;;;;;;;AChBA;AACA;AACA;AACA;;AAEA;AACA,2EAA2E;AAC3E;AACA,GAAG;AACH;AACA;AACA;;AAEA,2C;;;;;;;;;;;ACbA;AACA;AACA;;AAEA,kC;;;;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6C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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"UserAgent\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"UserAgent\"] = factory();\n\telse\n\t\troot[\"UserAgent\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nvar isNativeReflectConstruct = require(\"./isNativeReflectConstruct\");\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    module.exports = _construct = Reflect.construct;\n  } else {\n    module.exports = _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nmodule.exports = _construct;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nmodule.exports = _isNativeReflectConstruct;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableRest;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(n);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","/* 用于包裹构造函数，延迟初始化类 */\nexport class SyncDescriptor {\n    constructor(ctor, staticArguments = [], supportsDelayedInstantiation = false) {\n        this.ctor = ctor;\n        this.staticArguments = staticArguments;\n        this.supportsDelayedInstantiation = supportsDelayedInstantiation;\n    }\n}\n","function newNode(data) {\n    return {\n        data,\n        incoming: Object.create(null),\n        outcoming: Object.create(null),\n    };\n}\nexport class Graph {\n    constructor(keyFn) {\n        this.keyFn = keyFn;\n        this.nodes = Object.create(null);\n    }\n    /* 获取图结构的叶子节点 */\n    root() {\n        const ret = [];\n        for (const nodeKey in this.nodes) {\n            if (Object.prototype.hasOwnProperty.call(this.nodes, nodeKey)) {\n                const nodeElement = this.nodes[nodeKey];\n                if (Object.getOwnPropertyNames(nodeElement.outcoming).length === 0) {\n                    ret.push(nodeElement);\n                }\n            }\n        }\n        return ret;\n    }\n    /* 从图结构中获取节点，如果节点不存在就创建一个并插入图中 */\n    lookupOrInsertNode(data) {\n        const key = this.keyFn(data);\n        let node = this.nodes[key];\n        if (!node) {\n            node = newNode(data);\n            this.nodes[key] = node;\n        }\n        return node;\n    }\n    /* 在图结构中插入一条边 */\n    insertEdge(from, to) {\n        const fromNode = this.lookupOrInsertNode(from);\n        const toNode = this.lookupOrInsertNode(to);\n        const fromKey = this.keyFn(from);\n        const toKey = this.keyFn(to);\n        fromNode.outcoming[toKey] = toNode;\n        toNode.incoming[fromKey] = fromNode;\n    }\n    /* 在图结构中移除一个节点 */\n    removeNode(data) {\n        const delKey = this.keyFn(data);\n        delete this.nodes[delKey];\n        for (const nodeKey in this.nodes) {\n            if (Object.prototype.hasOwnProperty.call(this.nodes, nodeKey)) {\n                const nodeElement = this.nodes[nodeKey];\n                delete nodeElement.outcoming[delKey];\n                delete nodeElement.incoming[delKey];\n            }\n        }\n    }\n    /* 在图结构中查询节点 */\n    lookup(data) {\n        return this.nodes[this.keyFn(data)];\n    }\n    /* 判断图结构是否为空 */\n    isEmpty() {\n        return Object.keys(this.nodes).length === 0;\n    }\n}\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { createDecorator } from './instantiation';\nimport { InstantiationService } from './instantiationService';\nimport { ServiceCollection } from './serviceCollection';\nclass A {\n    echo() {\n        return 'A';\n    }\n}\nclass B {\n    echo() {\n        return 'B';\n    }\n}\n// 装饰器\nconst serviceA = createDecorator('A');\nconst serviceB = createDecorator('B');\nlet C = class C {\n    constructor(a, b, leftText = '', rightText = '') {\n        this.a = a;\n        this.b = b;\n        this.leftText = leftText;\n        this.rightText = rightText;\n    }\n    echo() {\n        return `${this.a.echo()}${this.b.echo()}${this.leftText}${this.rightText}`;\n    }\n};\nC = __decorate([\n    __param(0, serviceA), __param(1, serviceB)\n], C);\nconst aInstance = new A();\nconst bInstance = new B();\nconst svrsCollection = new ServiceCollection();\nsvrsCollection.set(serviceA, aInstance);\nsvrsCollection.set(serviceB, bInstance);\nconst instantiationService = new InstantiationService(svrsCollection);\nconst cInstance = instantiationService.createInstance(C, 'L', 'R');\nconsole.log(instantiationService);\nconsole.log(cInstance);\nconst echoText = cInstance.echo();\nconsole.log(echoText);\ninstantiationService.invokeFunction((accessor) => {\n    console.log(accessor);\n    const bInstance2 = accessor.get(serviceA);\n});\n","// 用于获取target的$di$dependencies属性存储的依赖关系\nexport var _util;\n(function (_util) {\n    _util.serviceIds = new Map();\n    _util.DI_TARGET = '$di$target';\n    _util.DI_DEPENDENCIES = '$di$dependencies';\n    function getServiceDependencies(ctor) {\n        return ctor[_util.DI_DEPENDENCIES] || [];\n    }\n    _util.getServiceDependencies = getServiceDependencies;\n})(_util || (_util = {}));\n// 用于在target的$di$dependencies属性存储依赖关系\nexport function storeServiceDependency(id, target, index, optional) {\n    if (target[_util.DI_TARGET] === target) {\n        target[_util.DI_DEPENDENCIES].push({ id, index, optional });\n    }\n    else {\n        target[_util.DI_TARGET] = target;\n        target[_util.DI_DEPENDENCIES] = [{ id, index, optional }];\n    }\n}\n// 创建decorator\nexport function createDecorator(serviceId) {\n    if (_util.serviceIds.has(serviceId)) {\n        return _util.serviceIds.get(serviceId);\n    }\n    const id = function serviceIdentifier(target, key, index) {\n        if (arguments.length !== 3) {\n            throw new Error('@IServiceName-decorator can only be used to decorate a parameter');\n        }\n        storeServiceDependency(id, target, index, false);\n    };\n    id.toString = () => serviceId;\n    _util.serviceIds.set(serviceId, id);\n    return id;\n}\n","import { Graph } from './graph';\nimport { _util, } from './instantiation';\nimport { ServiceCollection } from './serviceCollection';\nimport { SyncDescriptor } from './descriptors';\nexport class IdleValue {\n    constructor(executor) {\n        this.didRun = false;\n        this.executor = () => {\n            try {\n                this.value = executor();\n            }\n            catch (error) {\n                this.error = error;\n            }\n            finally {\n                this.didRun = true;\n            }\n        };\n    }\n    getValue() {\n        if (!this.didRun) {\n            this.executor();\n        }\n        if (this.error) {\n            throw this.error;\n        }\n        return this.value;\n    }\n}\nexport class InstantiationService {\n    constructor(serices = new ServiceCollection()) {\n        this.services = serices;\n    }\n    createInstance(ctorOrDescriptor, ...rest) {\n        const result = this.createCtorInstance(ctorOrDescriptor, rest);\n        return result;\n    }\n    invokeFunction(fn, ...args) {\n        let done = false;\n        try {\n            const accessor = {\n                get: (id) => {\n                    if (done) {\n                        throw new Error('service accessor is only valid during the invocation of its target method');\n                    }\n                    const result = this.getOrCreateServiceInstance(id);\n                    if (!result) {\n                        throw new Error(`[invokeFunction] unknown service '${id}'`);\n                    }\n                    return result;\n                },\n            };\n            return fn(accessor, ...args);\n        }\n        finally {\n            done = true;\n        }\n    }\n    createCtorInstance(ctor, args = []) {\n        const serviceDependencies = _util\n            .getServiceDependencies(ctor)\n            .sort((a, b) => a.index - b.index);\n        const serviceArgs = [];\n        for (const dependency of serviceDependencies) {\n            const serviceInstance = this.getOrCreateServiceInstance(dependency.id);\n            serviceArgs.push(serviceInstance);\n        }\n        // eslint-disable-next-line new-cap\n        return new ctor(...[...serviceArgs, ...args]);\n    }\n    getOrCreateServiceInstance(id) {\n        const thing = this.getServiceInstanceOrDescriptor(id);\n        if (thing instanceof SyncDescriptor) {\n            return this.createAndCacheServiceInstance(id, thing);\n        }\n        return thing;\n    }\n    getServiceInstanceOrDescriptor(id) {\n        const instanceOrDesc = this.services.get(id);\n        if (!instanceOrDesc) {\n            throw new Error(`service ${id.toString()} is not in collection`);\n        }\n        return instanceOrDesc;\n    }\n    createAndCacheServiceInstance(id, desc) {\n        const graph = new Graph((data) => data.id.toString());\n        const stack = [{ id, desc }];\n        while (stack.length) {\n            const item = stack.pop();\n            graph.lookupOrInsertNode(item);\n            for (const dependency of _util.getServiceDependencies(item.desc.ctor)) {\n                const instanceOrDesc = this.getServiceInstanceOrDescriptor(dependency.id);\n                if (instanceOrDesc instanceof SyncDescriptor) {\n                    const dItem = { id: dependency.id, desc: instanceOrDesc };\n                    graph.insertEdge(item, dItem);\n                    stack.push(dItem);\n                }\n            }\n        }\n        /* eslint-disable-next-line no-constant-condition */\n        while (true) {\n            const roots = graph.root();\n            if (roots.length === 0) {\n                break;\n            }\n            for (const { data } of roots) {\n                const service = this.createServiceInstance(data.id, data.desc.ctor, data.desc.staticArguments, data.desc.supportsDelayedInstantiation);\n                this.services.set(data.id, service);\n                graph.removeNode(data);\n            }\n        }\n        const service = this.getOrCreateServiceInstance(id);\n        return service;\n    }\n    createServiceInstance(id, ctor, args, supportsDelayedInstantiation) {\n        if (!(this.services.get(id) instanceof SyncDescriptor)) {\n            throw Error(`illegalState - create UNKNOW service instance ${id.toString()}`);\n        }\n        if (!supportsDelayedInstantiation) {\n            return this.createCtorInstance(ctor, args);\n        }\n        const idleObj = new IdleValue(() => this.createCtorInstance(ctor, args));\n        return new Proxy(Object.create(null), {\n            get(target, key) {\n                if (key in target) {\n                    return target[key];\n                }\n                const obj = idleObj.getValue();\n                const prop = obj[key];\n                if (typeof prop === 'function') {\n                    const bindProp = prop.bind(obj);\n                    target[key] = bindProp;\n                    return bindProp;\n                }\n                target[key] = prop;\n                return prop;\n            },\n            set(target, key, value) {\n                const obj = idleObj.getValue();\n                obj[key] = value;\n                return true;\n            },\n        });\n    }\n}\n","export class ServiceCollection {\n    constructor(...entries) {\n        this.entries = new Map();\n        for (const [id, service] of entries) {\n            this.set(id, service);\n        }\n    }\n    set(id, instanceOrDescriptor) {\n        const result = this.entries.get(id);\n        this.entries.set(id, instanceOrDescriptor);\n        return result;\n    }\n    has(id) {\n        return this.entries.has(id);\n    }\n    get(id) {\n        return this.entries.get(id);\n    }\n    forEach(callback) {\n        this.entries.forEach((value, key) => {\n            callback(key, value);\n        });\n    }\n}\n"],"sourceRoot":""}